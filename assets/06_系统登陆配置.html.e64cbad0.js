import{_ as p,o,c,a as n,e as t,b as s,d as e,r as i}from"./app.d0203023.js";var l="/sso/01_sso_app.jpg";const u={},r=n("h1",{id:"\u96C6\u6210\u5355\u70B9\u767B\u9646",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#\u96C6\u6210\u5355\u70B9\u767B\u9646","aria-hidden":"true"},"#"),s(" \u96C6\u6210\u5355\u70B9\u767B\u9646")],-1),k=n("h2",{id:"\u5DE5\u7A0B\u793A\u4F8B",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#\u5DE5\u7A0B\u793A\u4F8B","aria-hidden":"true"},"#"),s(" \u5DE5\u7A0B\u793A\u4F8B")],-1),d=s("\u7CFB\u7EDF\u5E94\u7528\u5355\u70B9\u96C6\u6210\u793A\u4F8B\u5DE5\u7A0B"),v={href:"https://gitee.com/alinesno-cloud/alinesno-demo-gateway-open/tree/master/demo-oauth2",target:"_blank",rel:"noopener noreferrer"},m=s("\u6253\u5F00"),b=e('<h2 id="\u672C\u5185\u5BB9\u4F60\u5C06\u83B7\u5F97" tabindex="-1"><a class="header-anchor" href="#\u672C\u5185\u5BB9\u4F60\u5C06\u83B7\u5F97" aria-hidden="true">#</a> \u672C\u5185\u5BB9\u4F60\u5C06\u83B7\u5F97</h2><ul><li>\u96C6\u6210 oauth2 \u5355\u70B9\u767B\u9646\u7684\u65B9\u5F0F</li><li>oauth2 \u6388\u6743\u670D\u52A1\u7684\u4F7F\u7528\u573A\u666F</li></ul><h2 id="\u7248\u672C\u8BF4\u660E" tabindex="-1"><a class="header-anchor" href="#\u7248\u672C\u8BF4\u660E" aria-hidden="true">#</a> \u7248\u672C\u8BF4\u660E</h2><ul><li>alinesno-ui:1.7 +</li><li>alinesno-cloud-platform:2.1.2-Alpha +</li></ul><h2 id="\u96C6\u6210\u6B65\u9AA4" tabindex="-1"><a class="header-anchor" href="#\u96C6\u6210\u6B65\u9AA4" aria-hidden="true">#</a> \u96C6\u6210\u6B65\u9AA4</h2><p>\u8FD9\u91CC\u4E3B\u8981\u628A\u96C6\u6210\u6B65\u9AA4\uFF0C\u90E8\u5206\u7EC6\u8282\u8BF7\u53C2\u8003\u793A\u4F8B\u5DE5\u7A0B</p><h3 id="\u83B7\u53D6\u767B\u9646\u5BC6\u94A5" tabindex="-1"><a class="header-anchor" href="#\u83B7\u53D6\u767B\u9646\u5BC6\u94A5" aria-hidden="true">#</a> \u83B7\u53D6\u767B\u9646\u5BC6\u94A5</h3><h4 id="\u767B\u9646\u7EDF\u4E00\u6388\u6743\u670D\u52A1" tabindex="-1"><a class="header-anchor" href="#\u767B\u9646\u7EDF\u4E00\u6388\u6743\u670D\u52A1" aria-hidden="true">#</a> \u767B\u9646\u7EDF\u4E00\u6388\u6743\u670D\u52A1</h4>',8),h=s("\u7EDF\u4E00\u6388\u6743\u670D\u52A1 "),f={href:"http://alinesno-oauth-admin.beta.linesno.com",target:"_blank",rel:"noopener noreferrer"},g=s("\u6253\u5F00"),_=n("li",null,"\u8D26\u53F7\u4E3A\u5E73\u53F0\u7BA1\u7406\u5458\u8D26\u53F7",-1),y=e('<h4 id="\u6DFB\u52A0\u5E94\u7528\u83B7\u53D6\u5BC6\u94A5" tabindex="-1"><a class="header-anchor" href="#\u6DFB\u52A0\u5E94\u7528\u83B7\u53D6\u5BC6\u94A5" aria-hidden="true">#</a> \u6DFB\u52A0\u5E94\u7528\u83B7\u53D6\u5BC6\u94A5</h4><p>\u6DFB\u52A0\u5E94\u7528\uFF0C\u5982\u4E0B\u56FE\uFF1A</p><img src="'+l+`" style="width:790px;"><p>\u914D\u7F6E\u8BF4\u660E:</p><ul><li>\u670D\u52A1\u5730\u5740\uFF1A \u5355\u70B9\u9000\u51FA\u56DE\u8C03\u8C03\u7528\uFF0C\u4F1A\u81EA\u52A8\u8C03\u7528http://\u670D\u52A1\u5730\u5740/sso/notifyUr</li><li>\u6388\u6743\u8303\u56F4: \u9009\u62E9\u81EA\u52A8\u6388\u6743\u670D\u52A1</li></ul><p>\u70B9\u51FB\u5217\u8868<code>\u5E94\u7528\u540D\u79F0</code>\u67E5\u770B\u5355\u70B9\u767B\u9646\u7684\u5BC6\u94A5</p><h3 id="\u524D\u7AEF\u914D\u7F6E\u5355\u70B9\u767B\u9646" tabindex="-1"><a class="header-anchor" href="#\u524D\u7AEF\u914D\u7F6E\u5355\u70B9\u767B\u9646" aria-hidden="true">#</a> \u524D\u7AEF\u914D\u7F6E\u5355\u70B9\u767B\u9646</h3><h4 id="\u6DFB\u52A0\u62E6\u622A\u914D\u7F6E" tabindex="-1"><a class="header-anchor" href="#\u6DFB\u52A0\u62E6\u622A\u914D\u7F6E" aria-hidden="true">#</a> \u6DFB\u52A0\u62E6\u622A\u914D\u7F6E</h4><p>\u5728 main.js \u4E2D\u6DFB\u52A0\u4EE5\u4E0B\u914D\u7F6E\u5F15\u5165\uFF1A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> EnableUaaClient <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;alinesno-ui/src/router/router-guard&#39;</span>

Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>EnableUaaClient<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">routerInstance</span><span class="token operator">:</span> router <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">el</span><span class="token operator">:</span> <span class="token string">&#39;#app&#39;</span><span class="token punctuation">,</span>
  router<span class="token punctuation">,</span>
  store<span class="token punctuation">,</span>
  <span class="token function-variable function">render</span><span class="token operator">:</span> <span class="token parameter">h</span> <span class="token operator">=&gt;</span> <span class="token function">h</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6CE8\u91CA\u6389 permission.js \u6587\u4EF6\u4E2D\u7684\u9000\u51FA\u914D\u7F6E\uFF0C\u6B64\u4F1A\u62E6\u622A\u5355\u70B9\u7684\u914D\u7F6E\uFF0C\u6CE8\u91CA\u6389\u5373\u53EF</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>router<span class="token punctuation">.</span><span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">to<span class="token punctuation">,</span> from<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  NProgress<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">getToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">/* has token*/</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>to<span class="token punctuation">.</span>path <span class="token operator">===</span> <span class="token string">&#39;/login&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">&#39;/&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
      NProgress<span class="token punctuation">.</span><span class="token function">done</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>store<span class="token punctuation">.</span>getters<span class="token punctuation">.</span>roles<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u5224\u65AD\u5F53\u524D\u7528\u6237\u662F\u5426\u5DF2\u62C9\u53D6\u5B8Cuser_info\u4FE1\u606F</span>
        store
          <span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">&#39;GetInfo&#39;</span><span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">&#39;GenerateRoutes&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">accessRoutes</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
              <span class="token comment">// \u6839\u636Eroles\u6743\u9650\u751F\u6210\u53EF\u8BBF\u95EE\u7684\u8DEF\u7531\u8868</span>
              router<span class="token punctuation">.</span><span class="token function">addRoutes</span><span class="token punctuation">(</span>accessRoutes<span class="token punctuation">)</span> <span class="token comment">// \u52A8\u6001\u6DFB\u52A0\u53EF\u8BBF\u95EE\u8DEF\u7531\u8868</span>
              <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token operator">...</span>to<span class="token punctuation">,</span> <span class="token literal-property property">replace</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// hack\u65B9\u6CD5 \u786E\u4FDDaddRoutes\u5DF2\u5B8C\u6210</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">// \u5355\u70B9\u767B\u9646\u6CE8\u91CA\u6389</span>
            <span class="token comment">// store.dispatch(&#39;LogOut&#39;).then(() =&gt; {</span>
            <span class="token comment">//   console.log(&#39;err = &#39; + err)</span>
            <span class="token comment">//   Message.error(err)</span>
            <span class="token comment">//   next({ path: &#39;/&#39; })</span>
            <span class="token comment">// })</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u9000\u51FA\u7684\u914D\u7F6E\uFF0C\u5728 store/modules/use.js \u914D\u7F6E LogOut \u54CD\u5E94\uFF0C\u5982\u4E0B</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>  <span class="token comment">// \u9000\u51FA\u7CFB\u7EDF</span>
    <span class="token function">LogOut</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> commit<span class="token punctuation">,</span> state<span class="token punctuation">,</span> payload <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">userLogout</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span>token<span class="token punctuation">,</span> payload<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">finally</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

           <span class="token keyword">var</span> userToken <span class="token operator">=</span> <span class="token function">getToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>
           <span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">&#39;SET_TOKEN&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">)</span>
           <span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">&#39;SET_ROLES&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
           <span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">&#39;SET_PERMISSIONS&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
           <span class="token function">removeToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

           window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token constant">BASE_API_URL</span> <span class="token operator">+</span> <span class="token string">&quot;/logout?userToken=&quot;</span> <span class="token operator">+</span> userToken <span class="token punctuation">;</span>
         <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
           <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
         <span class="token punctuation">}</span><span class="token punctuation">)</span>
       <span class="token punctuation">}</span><span class="token punctuation">)</span>
     <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="\u540E\u53F0\u96C6\u6210\u5355\u70B9\u767B\u9646" tabindex="-1"><a class="header-anchor" href="#\u540E\u53F0\u96C6\u6210\u5355\u70B9\u767B\u9646" aria-hidden="true">#</a> \u540E\u53F0\u96C6\u6210\u5355\u70B9\u767B\u9646</h3><p>\u8C03\u7528<code>EnableApi</code>\u6CE8\u89E3\u4E3A<code>EnableSSO</code>\uFF0C\u5982\u4E0B\u56FE:</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// @EnableApi</span>
<span class="token annotation punctuation">@EnableSSO</span>  <span class="token comment">// \u5355\u70B9\u767B\u9646\u6CE8\u89E3</span>
<span class="token annotation punctuation">@SpringBootApplication</span><span class="token punctuation">(</span>exclude <span class="token operator">=</span> <span class="token class-name">DataSourceAutoConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SaasWebApplication</span> <span class="token punctuation">{</span>

	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
		<span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">SaasWebApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6DFB\u52A0\u5355\u70B9\u767B\u9646\u914D\u7F6E\uFF0C\u5728 yaml \u6587\u4EF6\u4E2D\u6DFB\u52A0\u4EE5\u4E0B\u914D\u7F6E</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">alinesno</span><span class="token punctuation">:</span>
  <span class="token key atrule">uaa</span><span class="token punctuation">:</span>
    <span class="token key atrule">redirect-uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span><span class="token number">1024</span>
    <span class="token key atrule">client-id</span><span class="token punctuation">:</span> 43b564b9f38dea259a39270ed1dd8159
    <span class="token key atrule">client-secret</span><span class="token punctuation">:</span> <span class="token number">897777476384587776</span>
    <span class="token key atrule">authorization-server</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//alinesno<span class="token punctuation">-</span>oauth<span class="token punctuation">-</span>server.beta.linesno.com
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5230\u6B64\u5904\u914D\u7F6E\u5B8C\u6210\uFF0C\u91CD\u65B0\u8BBF\u95EE\u524D\u7AEF\u7684\u65F6\u5019\uFF0C\u4F1A\u81EA\u52A8\u8DF3\u8F6C\u5230\u5355\u70B9\u767B\u9646\u7684\u8BBA\u8BC1</p><h2 id="\u5176\u5B83" tabindex="-1"><a class="header-anchor" href="#\u5176\u5B83" aria-hidden="true">#</a> \u5176\u5B83</h2><ul><li>\u65E0</li></ul>`,22);function x(w,S){const a=i("ExternalLinkIcon");return o(),c("div",null,[r,k,n("p",null,[d,n("a",v,[m,t(a)])]),b,n("ul",null,[n("li",null,[h,n("a",f,[g,t(a)])]),_]),y])}var E=p(u,[["render",x],["__file","06_\u7CFB\u7EDF\u767B\u9646\u914D\u7F6E.html.vue"]]);export{E as default};
