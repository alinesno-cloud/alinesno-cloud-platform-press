(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{240:function(s,t,a){"use strict";a.r(t);var r=a(0),e=Object(r.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"content"},[s._m(0),s._v(" "),s._m(1),s._v(" "),a("ul",[a("li",[s._v("docker 镜像化工程示例"),a("a",{attrs:{href:"http://git.linesno.com/alinsno-cloud-platform-rutron/acp-ini-demo",target:"_blank",rel:"noopener noreferrer"}},[s._v("打开"),a("OutboundLink")],1)]),s._v(" "),a("li",[s._v("docker 镜像化演示应用"),a("a",{attrs:{href:"http://demo.ui.lbxinhu.linesno.com/",target:"_blank",rel:"noopener noreferrer"}},[s._v("打开"),a("OutboundLink")],1),s._v(" 演示账号密码: suze_test/123456")])]),s._v(" "),s._m(2),s._v(" "),s._m(3),s._v(" "),s._m(4),s._v(" "),a("p",[s._v("这里打镜像使用的插件是 jib-maven-plugin\n在 pom.xml 文件中台添加如下配置")]),s._v(" "),s._m(5),a("p",[s._v("配置好 pom.xml 接下来就可以通过 mvn compile jib:build 打包镜像并发布到镜像仓库，通过 mvn compile jib:dockerBuild 打包镜像到本地, 中台工程已经集成 jib-maven-plugin 组件，要改变镜像仓库地址时可以通过在构建时 -Djib.to.image 来设置")]),s._v(" "),s._m(6),s._v(" "),a("p",[s._v("在工程 ui 模块下创建 Dockerfile 文件,如下")]),s._v(" "),s._m(7),a("p",[s._v("同样在 ui 模块下创建文件 build-docker.sh，如下")]),s._v(" "),s._m(8),a("p",[s._v("注意： 代码生成器生成工程"),a("a",{attrs:{href:"http://alinesno-platform.linesno.com/technique/09_%E5%BC%80%E5%8F%91%E6%8E%A5%E5%85%A5/02_%E7%94%9F%E6%88%90%E4%BB%A3%E7%A0%81.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("打开"),a("OutboundLink")],1),s._v("已经自动生成相应的 dockerfile 和 build-docker.sh 文件，默认可以直接拿来用")]),s._v(" "),a("p",[s._v("这样，等前端构建好，就可以通过运行 build-docker.sh 构建好前端镜像")]),s._v(" "),a("p",[s._v("使用 docker-compose 部署应用\ndocker-compose 是一个关联 docker 容器的工具，他通过一个配置文件来管理多个容器，通过 docker-compose 可以对应用进行部署")]),s._v(" "),a("p",[s._v("docker-compose.yaml 脚本配置")]),s._v(" "),s._m(9),a("p",[s._v("需要注意，可以通过在 docker-compose 中设置环境变量，然后通过设置环境变量，对配置文件进行配置\n如上面示例中的 redis 配置，在配置文件中对应如下配置:")]),s._v(" "),s._m(10),a("p",[s._v("这样就可以通过 docker-compose.yaml 对项目进行配置了\n就像演示工程中的后端的 docker-compose.yaml")]),s._v(" "),s._m(11),a("p",[s._v("前端的 docker-compose.yaml")]),s._v(" "),s._m(12)])}),[function(){var s=this.$createElement,t=this._self._c||s;return t("h1",{attrs:{id:"业务服务-docker-镜像化"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#业务服务-docker-镜像化"}},[this._v("#")]),this._v(" 业务服务 Docker 镜像化")])},function(){var s=this.$createElement,t=this._self._c||s;return t("h2",{attrs:{id:"工程示例"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#工程示例"}},[this._v("#")]),this._v(" 工程示例")])},function(){var s=this.$createElement,t=this._self._c||s;return t("h2",{attrs:{id:"本内容你将获得"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#本内容你将获得"}},[this._v("#")]),this._v(" 本内容你将获得")])},function(){var s=this.$createElement,t=this._self._c||s;return t("ul",[t("li",[this._v("使用 jib 插件帮后端打镜像")]),this._v(" "),t("li",[this._v("使用 dockerfile 帮前端打镜像")]),this._v(" "),t("li",[this._v("使用 docker-compose 部署应用")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("h2",{attrs:{id:"使用-jib-插件帮后端打镜像"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用-jib-插件帮后端打镜像"}},[this._v("#")]),this._v(" 使用 jib 插件帮后端打镜像")])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("      "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("build"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("plugins"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n             "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("plugin"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("groupId"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("com.google.cloud.tools"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/groupId"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("artifactId"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("jib-maven-plugin"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/artifactId"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("version"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.1")]),s._v("."),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("4")]),s._v("<")]),s._v("/version"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("configuration"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                     "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("from"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                         "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("--  基础镜像，由于中台工程使用的jdk为11版本，这里使用jdk11的基础镜像 --"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                         "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("image"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("registry.cn-shenzhen.aliyuncs.com/alinesno-base/openjdk11:11.0."),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v("<")]),s._v("/image"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                     "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/from"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                      "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("打出的镜像的tag设置"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                     "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("to"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                         "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("image"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                                 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("--   docker_repostory  为镜像仓库地址 ， docker_registry_name为镜像仓库项目名\n                                           project.artifactId为镜像名，这里设置为工程artifactId ，\n                                           project.version为镜像版本 ，这里设置为工程版本--"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                                "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("docker_repostory"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("/"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("docker_registry_name"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("/"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${project.artifactId}")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${project.version}")]),s._v("\n                         "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/image"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                         "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("--\n                         "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("tags"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                             "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("tag"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("project.version"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/tag"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("-- project.version工程版本号 --"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                             "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("-- "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("tag"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("latest"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/tag"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" --"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                         "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/tags"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                          --"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                         "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("auth"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                             "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("--在docker-hub或者阿里云上的账号和密码，这里用环境变量方式，方便适配--"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                             "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("username"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${env.REGISTRY_USERNAME}")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/username"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                             "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("password"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${env.REGISTRY_PASSWORD}")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/password"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                         "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/auth"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                     "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/to"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                     "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("container"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                          "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("--  服务启动配置  --"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                         "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("jvmFlags"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                             "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("jvmFlag"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("-Dfile.encoding"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("UTF-"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("8")]),s._v("<")]),s._v("/jvmFlag"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                              "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("--\n                              调整成 -e "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("JAVA_TOOL_OPTIONS")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-Xms128m -Xmx512m -Dspring.profiles.active=hub"')]),s._v("\n                              传递参数,以适应多种环境\n                              "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("jvmFlag"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("-Xms128m"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/jvmFlag"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                              "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("jvmFlag"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("-Xmx512m"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/jvmFlag"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                              "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("jvmFlag"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("-Dspring.profiles.active"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("hub"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/jvmFlag"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                              "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("jvmFlag"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("-XX:+UseParNewGC"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/jvmFlag"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                              "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("jvmFlag"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("-XX:+UseConcMarkSweepGC"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/jvmFlag"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                               --"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                             "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("jvmFlag"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("-XX:+DisableExplicitGC"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/jvmFlag"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                             "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("jvmFlag"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("-Xdebug"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/jvmFlag"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                             "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("jvmFlag"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("-Duser.timezone"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("GMT+0"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("8")]),s._v("<")]),s._v("/jvmFlag"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                             "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("jvmFlag"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("-Djava.security.egd"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("file:/dev/./urandom"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/jvmFlag"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n\n                         "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/jvmFlags"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                         "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("--  校准时间,设置构建镜像的时间  --"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                         "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("useCurrentTimestamp"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("true"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/useCurrentTimestamp"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                     "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/container"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                      "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("-- 允许使用http连接镜像仓库,默认为false,可以设置为true --"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                     "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("allowInsecureRegistries"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("false"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/allowInsecureRegistries"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/configuration"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n             "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/plugin"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/plugins"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/build"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])])])},function(){var s=this.$createElement,t=this._self._c||s;return t("h2",{attrs:{id:"使用-dockerfile-帮前端打镜像"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用-dockerfile-帮前端打镜像"}},[this._v("#")]),this._v(" 使用 dockerfile 帮前端打镜像")])},function(){var s=this.$createElement,t=this._self._c||s;return t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[this._v(" FROM registry.cn-shenzhen.aliyuncs.com/alinesno-base/nginx-alpha:1.1.0     "),t("span",{pre:!0,attrs:{class:"token comment"}},[this._v("#基础镜像")]),this._v("\n WORKDIR /usr/share/nginx/html               "),t("span",{pre:!0,attrs:{class:"token comment"}},[this._v("# 工作目录")]),this._v("\n\n "),t("span",{pre:!0,attrs:{class:"token comment"}},[this._v("# 将dist目录下的内容复制到工作目录下，这里要工程先构建到 dist 目录下")]),this._v("\n COPY ./dist ./\n")])])])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# !/bin/sh")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 镜像参数")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("docker_repostory")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("docker_repostory"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#docker_repostory指镜像仓库地址")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("docker_registry_name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("docker_registry_name"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#docker_registry_name指镜像仓库项目名")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("project_artifactid")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("project_artifactid"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#project_artifactid指镜像名")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("project_version")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("project_version"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#project_version指镜像版本号")]),s._v("\n\n "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 构建镜像")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" build -t "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${docker_repostory}")]),s._v("/"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${docker_registry_name}")]),s._v("/"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${project_artifactid}")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${project_version}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n\n "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 发布镜像")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" push "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${docker_repostory}")]),s._v("/"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${docker_registry_name}")]),s._v("/"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${project_artifactid}")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${project_version}")]),s._v("\n")])])])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v(" version: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"3"')]),s._v("\n services:\n     services_name:\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#映射端口")]),s._v("\n         ports:\n             - "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"38080:8080"')]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#副本数量，这里为1")]),s._v("\n         deploy:\n             replicas: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n         image:   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("image_url"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#镜像地址")]),s._v("\n         "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  环境变量配置")]),s._v("\n         environment:\n             - "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("SPRING_APPLICATION_NAME")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("alinesno-cloud-yyt-shop\n             - "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("JAVA_TOOL_OPTIONS")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("-Xms128m -Xmx512m -Dspring.profiles.active"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("hub\n             - "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("SERVER_PORT")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v("                    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#应用启动端口")]),s._v("\n             - "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("REDIS_HOST")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1\n             - "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("REDIS_PORT")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6379")]),s._v("\n             - "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("REDIS_PASSWORD")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("password"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#password:  redis密码")]),s._v("\n         "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#数据卷")]),s._v("\n         volumes:\n             - "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/etc/localtime:/etc/localtime"')]),s._v("\n             - "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./app/upload-files:/root/alinesno-upload-files"')]),s._v("\n             - "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./app/upload-files:/tmp"')]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#容器网络配置，设置网段为172.201.0.0，防止路由冲突")]),s._v("\n networks:\n     suinet:\n         ipam:\n             config:\n             - subnet: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.201")]),s._v(".0.0/16\n")])])])},function(){var s=this.$createElement,t=this._self._c||s;return t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[this._v("   redis:\n     host: "),t("span",{pre:!0,attrs:{class:"token variable"}},[this._v("${REDIS_HOST}")]),this._v("\n     port: "),t("span",{pre:!0,attrs:{class:"token variable"}},[this._v("${REDIS_PORT}")]),this._v("\n     password: "),t("span",{pre:!0,attrs:{class:"token variable"}},[this._v("${REDIS_PASSWORD}")]),this._v("\n")])])])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v(" version: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"3"')]),s._v("\n services:\n     demo-service:\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#映射端口")]),s._v("\n         ports:\n             - "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"38080:8080"')]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#副本数量，这里为1")]),s._v("\n         deploy:\n             replicas: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n         image: project_image_url   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#镜像地址")]),s._v("\n         "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  环境变量配置")]),s._v("\n         environment:\n             - "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("SPRING_APPLICATION_NAME")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("SUZE_TEST\n             - "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("JAVA_TOOL_OPTIONS")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" -Xms128m -Xmx512m -Dspring.profiles.active"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("hub\n             - "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("SERVER_PORT")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v("                    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#应用启动端口")]),s._v("\n             - "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("REDIS_HOST")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ENC"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("VfKVXnavjlwb42Sfo8oF3H1UB3iJFmgb"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n             - "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("REDIS_PORT")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ENC"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("l1gtKPHUtWk83ZflT9xNFQ"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n             - "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("REDIS_PASSWORD")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ENC"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ZCcv8B6TyhvMHcARsUj+LvpcMiwndFKOMP/qKsLhBC8"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n             - "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("DATASOURCE_URL")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ENC"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("mUOUukYqxfCd/ZnlgE+SIUJuu8+ldqcJRt1Z8CbWJUwaNwqpPB4YQAP/e9vwJyA0QKuQFPEyfO1cu57E0NKbALaOsBZ/e1xj6lt5eF5vqUFZh8Adgyz2+5hDj+lqHJeXAdfPBv2f7XRVJeM2KF1+QFakACU/MJdjfLvpgHRONlPQeGrehxTGQgpjkrveBB77CXmqDYSjEck"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n             - "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("DATASOURCE_USERNAME")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ENC"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("btFx+DeL1C4/DYK8QFXfIntzcXld/ajo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n             - "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("DATASOURCE_PASSWORD")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ENC"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("9C5Pev/FjL94gVbPJfaoxGEi8nkXHsNQ"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n         "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#数据卷")]),s._v("\n         volumes:\n             - "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/etc/localtime:/etc/localtime"')]),s._v("\n             - "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./app/upload-files:/root/alinesno-upload-files"')]),s._v("\n             - "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./app/upload-files:/tmp"')]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#容器网络配置，设置网段为172.201.0.0，防止路由冲突")]),s._v("\n networks:\n     servicenet:\n         ipam:\n             config:\n             - subnet: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.201")]),s._v(".0.0/16\n")])])])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("version: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"3"')]),s._v("\nservices:\n    demo-ui:\n       "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#映射端口")]),s._v("\n        ports:\n          - "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"38081:80"')]),s._v("\n         "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#副本数量，这里为1")]),s._v("\n        deploy:\n          replicas: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n        image:   project_image_url   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#镜像地址")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  环境变量配置")]),s._v("\n        environment:\n          - "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("API_BASE_URL")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("http://demo.service.lbxinhu.linesno.com\n          - "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("SERVER_CDN_URL")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("\n          - "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("SERVER_STORAGE_UPLOAD_URL")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("http://alinesno-saas.admin.dev.rutron.cn/common/storage/upload\n          - "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("SERVER_STORAGE_DISPLAY_URL")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("http://alinesno-storage.admin.dev.rutron.cn/storage/displayImg/\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#数据卷")]),s._v("\n        volumes:\n          - "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/etc/localtime:/etc/localtime"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#容器网络配置，设置网段为172.202.0.0，防止路由冲突")]),s._v("\nnetworks:\n    uinet:\n        ipam:\n            config:\n            - subnet: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.202")]),s._v(".0.0/16\n")])])])}],!1,null,null,null);t.default=e.exports}}]);