(window.webpackJsonp=window.webpackJsonp||[]).push([[40],{261:function(t,s,_){"use strict";_.r(s);var a=_(0),v=Object(a.a)({},(function(){var t=this.$createElement;this._self._c;return this._m(0)}),[function(){var t=this,s=t.$createElement,_=t._self._c||s;return _("div",{staticClass:"content"},[_("h1",{attrs:{id:"访问数据采集"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#访问数据采集"}},[t._v("#")]),t._v(" 访问数据采集")]),t._v(" "),_("h2",{attrs:{id:"概述"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#概述"}},[t._v("#")]),t._v(" 概述")]),t._v(" "),_("p",[t._v("用户访问网站的数据采集和分析，用于分析访问的基本信息，包括时间，地理位置等")]),t._v(" "),_("h2",{attrs:{id:"http-网站采集"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#http-网站采集"}},[t._v("#")]),t._v(" http 网站采集")]),t._v(" "),_("blockquote",[_("p",[t._v("主要用于基础环境场景")])]),t._v(" "),_("h3",{attrs:{id:"采集字段说明"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#采集字段说明"}},[t._v("#")]),t._v(" 采集字段说明")]),t._v(" "),_("table",[_("thead",[_("tr",[_("th",[t._v("序号")]),t._v(" "),_("th",[t._v("nginx 标识")]),t._v(" "),_("th",[t._v("字段名称")]),t._v(" "),_("th",[t._v("备注")])])]),t._v(" "),_("tbody",[_("tr",[_("td",[t._v("1")]),t._v(" "),_("td",[t._v("$remote_addr")]),t._v(" "),_("td",[t._v("客户端 IP")]),t._v(" "),_("td")]),t._v(" "),_("tr",[_("td",[t._v("1")]),t._v(" "),_("td",[t._v("$time_local")]),t._v(" "),_("td",[t._v("通用日志格式下的本地时间")]),t._v(" "),_("td")]),t._v(" "),_("tr",[_("td",[t._v("1")]),t._v(" "),_("td",[t._v("$status")]),t._v(" "),_("td",[t._v("状态码")]),t._v(" "),_("td")]),t._v(" "),_("tr",[_("td",[t._v("1")]),t._v(" "),_("td",[t._v("$body_bytes_sent")]),t._v(" "),_("td",[t._v("发送给客户端的字节数，不包括响应头的大小")]),t._v(" "),_("td")]),t._v(" "),_("tr",[_("td",[t._v("1")]),t._v(" "),_("td",[t._v("$http_user_agent")]),t._v(" "),_("td",[t._v("客户端浏览器信息")]),t._v(" "),_("td")]),t._v(" "),_("tr",[_("td",[t._v("1")]),t._v(" "),_("td",[t._v("$http_referer")]),t._v(" "),_("td",[t._v("请求的 referer 地址。")]),t._v(" "),_("td")]),t._v(" "),_("tr",[_("td",[t._v("1")]),t._v(" "),_("td",[t._v("$request")]),t._v(" "),_("td",[t._v("完整的原始请求")]),t._v(" "),_("td")]),t._v(" "),_("tr",[_("td",[t._v("1")]),t._v(" "),_("td",[t._v("$request_method")]),t._v(" "),_("td",[t._v('HTTP 请求方法，通常为"GET"或"POST"')]),t._v(" "),_("td")]),t._v(" "),_("tr",[_("td",[t._v("1")]),t._v(" "),_("td",[t._v("$request_time")]),t._v(" "),_("td",[t._v("请求处理时长")]),t._v(" "),_("td")]),t._v(" "),_("tr",[_("td",[t._v("1")]),t._v(" "),_("td",[t._v("$request_uri")]),t._v(" "),_("td",[t._v("完整的请求地址")]),t._v(" "),_("td")]),t._v(" "),_("tr",[_("td",[t._v("1")]),t._v(" "),_("td",[t._v("$server_protocol")]),t._v(" "),_("td",[t._v('服务器的 HTTP 版本，通常为 "HTTP/1.0" 或 "HTTP/1.1"')]),t._v(" "),_("td")]),t._v(" "),_("tr",[_("td",[t._v("1")]),t._v(" "),_("td",[t._v("$request_body")]),t._v(" "),_("td",[t._v("POST 请求参数,参数需放 form 中")]),t._v(" "),_("td")]),t._v(" "),_("tr",[_("td",[t._v("1")]),t._v(" "),_("td",[t._v("token $http_token")]),t._v(" "),_("td",[t._v("(自定义 header 字段前加 http_，即可将指定的自定义 header 字段打印到 log 中)")]),t._v(" "),_("td")])])]),t._v(" "),_("h3",{attrs:{id:"采集格式"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#采集格式"}},[t._v("#")]),t._v(" 采集格式")]),t._v(" "),_("div",{staticClass:"language-shell extra-class"},[_("pre",{pre:!0,attrs:{class:"language-shell"}},[_("code",[t._v("log_format user_log_format "),_("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),_("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$remote_addr")]),t._v(",\n    "),_("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$time_local")]),t._v(",\n    "),_("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$status")]),t._v(",\n    "),_("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$body_bytes_sent")]),t._v(",\n    "),_("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$http_user_agent")]),t._v(",\n    "),_("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$http_referer")]),t._v(",\n    "),_("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$request_method")]),t._v(",\n    "),_("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$request_time")]),t._v(",\n    "),_("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$request_uri")]),t._v(",\n    "),_("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$server_protocol")]),t._v(",\n    "),_("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$request_body")]),t._v(","),_("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$http_token")]),t._v('"')]),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),_("h3",{attrs:{id:"对应的-hive-数据表结构"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#对应的-hive-数据表结构"}},[t._v("#")]),t._v(" 对应的 hive 数据表结构")]),t._v(" "),_("div",{staticClass:"language-sql extra-class"},[_("pre",{pre:!0,attrs:{class:"language-sql"}},[_("code",[_("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CREATE")]),t._v(" "),_("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("TABLE")]),t._v(" ods_nginx_access_log"),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    remote_addr string"),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    time_local string"),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),_("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("status")]),t._v(" string"),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    body_bytes_sent string"),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    http_user_agent string"),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    http_referer string"),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    request_method string"),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    request_time string"),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    request_uri string"),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    server_protocol string"),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    request_body string"),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    http_token string"),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    id string"),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    appkey string"),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    sing string"),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    VERSION string"),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),_("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("clustered")]),t._v(" "),_("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("BY")]),t._v(" "),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("id"),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),_("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("INTO")]),t._v(" "),_("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v(" buckets stored "),_("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("AS")]),t._v(" orc TBLPROPERTIES "),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),_("span",{pre:!0,attrs:{class:"token string"}},[t._v("'transactional'")]),_("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),_("span",{pre:!0,attrs:{class:"token string"}},[t._v("'true'")]),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),_("h2",{attrs:{id:"proxy-代理数据采集"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#proxy-代理数据采集"}},[t._v("#")]),t._v(" proxy 代理数据采集")]),t._v(" "),_("blockquote",[_("p",[t._v("主要用于 k8s 访问日志场景，代理 ingress 数据访问")])]),t._v(" "),_("h3",{attrs:{id:"采集字段说明-2"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#采集字段说明-2"}},[t._v("#")]),t._v(" 采集字段说明")]),t._v(" "),_("table",[_("thead",[_("tr",[_("th",[t._v("序号")]),t._v(" "),_("th",[t._v("nginx 标识")]),t._v(" "),_("th",[t._v("字段名称")]),t._v(" "),_("th",[t._v("备注")])])]),t._v(" "),_("tbody",[_("tr",[_("td",[t._v("1")]),t._v(" "),_("td",[t._v("$remote_addr")]),t._v(" "),_("td",[t._v("客户端 IP")]),t._v(" "),_("td")]),t._v(" "),_("tr",[_("td",[t._v("1")]),t._v(" "),_("td",[t._v("$time_local")]),t._v(" "),_("td",[t._v("通用日志格式下的本地时间")]),t._v(" "),_("td")]),t._v(" "),_("tr",[_("td",[t._v("1")]),t._v(" "),_("td",[t._v("$status")]),t._v(" "),_("td",[t._v("状态码")]),t._v(" "),_("td")]),t._v(" "),_("tr",[_("td",[t._v("1")]),t._v(" "),_("td",[t._v("$binary_remote_addr")]),t._v(" "),_("td",[t._v("二进制格式的客户端地址")]),t._v(" "),_("td")]),t._v(" "),_("tr",[_("td",[t._v("1")]),t._v(" "),_("td",[t._v("$bytes_received")]),t._v(" "),_("td",[t._v("从客户端接收的字节数(1.11.4)")]),t._v(" "),_("td")]),t._v(" "),_("tr",[_("td",[t._v("1")]),t._v(" "),_("td",[t._v("$bytes_sent")]),t._v(" "),_("td",[t._v("发送到客户端的字节数")]),t._v(" "),_("td")]),t._v(" "),_("tr",[_("td",[t._v("1")]),t._v(" "),_("td",[t._v("$connection")]),t._v(" "),_("td",[t._v("连接序列号")]),t._v(" "),_("td")]),t._v(" "),_("tr",[_("td",[t._v("1")]),t._v(" "),_("td",[t._v("$hostname")]),t._v(" "),_("td",[t._v("主机名")]),t._v(" "),_("td")]),t._v(" "),_("tr",[_("td",[t._v("1")]),t._v(" "),_("td",[t._v("$msec")]),t._v(" "),_("td",[t._v("当前时间在秒和毫秒分辨率")]),t._v(" "),_("td")]),t._v(" "),_("tr",[_("td",[t._v("1")]),t._v(" "),_("td",[t._v("$nginx_version")]),t._v(" "),_("td",[t._v("nginx 版本")]),t._v(" "),_("td")]),t._v(" "),_("tr",[_("td",[t._v("1")]),t._v(" "),_("td",[t._v("$pid")]),t._v(" "),_("td",[t._v("工作进程的 PID")]),t._v(" "),_("td")]),t._v(" "),_("tr",[_("td",[t._v("1")]),t._v(" "),_("td",[t._v("$protocol")]),t._v(" "),_("td",[t._v("协议用于与客户沟通: TCP 或 UDP(1.11.4)")]),t._v(" "),_("td")]),t._v(" "),_("tr",[_("td",[t._v("1")]),t._v(" "),_("td",[t._v("$proxy_protocol_addr")]),t._v(" "),_("td",[t._v("客户端地址从代理协议头,否则或空字符串(1.11.4)")]),t._v(" "),_("td")]),t._v(" "),_("tr",[_("td",[t._v("1")]),t._v(" "),_("td",[t._v("$proxy_protocol_port")]),t._v(" "),_("td",[t._v("代理协议之前必须通过设置启用 proxy_protocol 参数听指令")]),t._v(" "),_("td")]),t._v(" "),_("tr",[_("td",[t._v("1")]),t._v(" "),_("td",[t._v("$remote_addr")]),t._v(" "),_("td",[t._v("客户端地址")]),t._v(" "),_("td")]),t._v(" "),_("tr",[_("td",[t._v("1")]),t._v(" "),_("td",[t._v("$remote_port")]),t._v(" "),_("td",[t._v("客户端端口")]),t._v(" "),_("td")]),t._v(" "),_("tr",[_("td",[t._v("1")]),t._v(" "),_("td",[t._v("$server_addr")]),t._v(" "),_("td",[t._v("接受连接过来的服务器的地址")]),t._v(" "),_("td")]),t._v(" "),_("tr",[_("td",[t._v("1")]),t._v(" "),_("td",[t._v("$server_port")]),t._v(" "),_("td",[t._v("接受了一个连接端口的服务器")]),t._v(" "),_("td")]),t._v(" "),_("tr",[_("td",[t._v("1")]),t._v(" "),_("td",[t._v("$session_time")]),t._v(" "),_("td",[t._v("会话持续时间在秒和毫秒分辨率(1.11.4);")]),t._v(" "),_("td")]),t._v(" "),_("tr",[_("td",[t._v("1")]),t._v(" "),_("td",[t._v("$status")]),t._v(" "),_("td",[t._v("会话状态")]),t._v(" "),_("td")]),t._v(" "),_("tr",[_("td",[t._v("1")]),t._v(" "),_("td",[t._v("$time_iso8601")]),t._v(" "),_("td",[t._v("当地时间的 ISO 8601 标准格式")]),t._v(" "),_("td")])])]),t._v(" "),_("h3",{attrs:{id:"采集格式-2"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#采集格式-2"}},[t._v("#")]),t._v(" 采集格式")]),t._v(" "),_("div",{staticClass:"language-shell extra-class"},[_("pre",{pre:!0,attrs:{class:"language-shell"}},[_("code",[t._v("log_format proxy_format  "),_("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),_("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$remote_addr")]),t._v(",\n    "),_("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$time_local")]),t._v(",\n    "),_("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$status")]),t._v(",\n    "),_("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$upstream_bytes_sent")]),t._v(",\n    "),_("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$protocol")]),t._v(",\n    "),_("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$upstream_addr")]),t._v(",\n    "),_("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$bytes_sent")]),t._v(",\n    "),_("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$bytes_received")]),t._v(",\n    "),_("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$session_time")]),t._v(",\n    "),_("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$upstream_bytes_received")]),t._v(",\n    "),_("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$upstream_connect_time")]),t._v('"')]),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),_("h3",{attrs:{id:"对应的-hive-数据表结构-2"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#对应的-hive-数据表结构-2"}},[t._v("#")]),t._v(" 对应的 hive 数据表结构")]),t._v(" "),_("div",{staticClass:"language-sql extra-class"},[_("pre",{pre:!0,attrs:{class:"language-sql"}},[_("code",[_("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CREATE")]),t._v(" "),_("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("TABLE")]),t._v(" ods_nginx_proxy_log"),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    remote_addr string"),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    time_local string"),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),_("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("status")]),t._v(" string"),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    upstream_bytes_sent string"),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    protocol string "),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    upstream_addr string "),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    bytes_sent string "),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    bytes_received string "),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    session_time string "),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    upstream_bytes_received string "),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    upstream_connect_time string "),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    id string"),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    appkey string"),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    sing string"),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    VERSION string"),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),_("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("clustered")]),t._v(" "),_("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("BY")]),t._v(" "),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("id"),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),_("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("INTO")]),t._v(" "),_("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v(" buckets stored "),_("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("AS")]),t._v(" orc TBLPROPERTIES "),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),_("span",{pre:!0,attrs:{class:"token string"}},[t._v("'transactional'")]),_("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),_("span",{pre:!0,attrs:{class:"token string"}},[t._v("'true'")]),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),_("h2",{attrs:{id:"其它"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#其它"}},[t._v("#")]),t._v(" 其它")]),t._v(" "),_("ul",[_("li",[t._v("略")])])])}],!1,null,null,null);s.default=v.exports}}]);