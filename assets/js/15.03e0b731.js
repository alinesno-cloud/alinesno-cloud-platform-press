(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{242:function(s,t,a){"use strict";a.r(t);var r=a(0),e=Object(r.a)({},(function(){var s=this,t=s._self._c;return t("div",{staticClass:"content"},[s._m(0),s._v(" "),s._m(1),s._v(" "),t("ul",[t("li",[s._v("docker 镜像化工程示例"),t("a",{attrs:{href:"http://git.linesno.com/alinsno-cloud-platform-rutron/acp-ini-demo",target:"_blank",rel:"noopener noreferrer"}},[s._v("打开"),t("OutboundLink")],1)]),s._v(" "),t("li",[s._v("docker 镜像化演示应用"),t("a",{attrs:{href:"http://demo.ui.lbxinhu.linesno.com/",target:"_blank",rel:"noopener noreferrer"}},[s._v("打开"),t("OutboundLink")],1),s._v(" 演示账号密码: suze_test/123456")])]),s._v(" "),s._m(2),s._v(" "),s._m(3),s._v(" "),s._m(4),s._v(" "),t("p",[s._v("这里打镜像使用的插件是 jib-maven-plugin\n在 pom.xml 文件中台添加如下配置")]),s._v(" "),s._m(5),t("p",[s._v("配置好 pom.xml 接下来就可以通过 mvn compile jib:build 打包镜像并发布到镜像仓库，通过 mvn compile jib:dockerBuild 打包镜像到本地, 中台工程已经集成 jib-maven-plugin 组件，要改变镜像仓库地址时可以通过在构建时 -Djib.to.image 来设置")]),s._v(" "),s._m(6),s._v(" "),t("p",[s._v("在工程 ui 模块下创建 Dockerfile 文件,如下")]),s._v(" "),s._m(7),t("p",[s._v("同样在 ui 模块下创建文件 build-docker.sh，如下")]),s._v(" "),s._m(8),t("p",[s._v("注意： 代码生成器生成工程"),t("a",{attrs:{href:"http://alinesno-platform.linesno.com/technique/09_%E5%BC%80%E5%8F%91%E6%8E%A5%E5%85%A5/02_%E7%94%9F%E6%88%90%E4%BB%A3%E7%A0%81.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("打开"),t("OutboundLink")],1),s._v("已经自动生成相应的 dockerfile 和 build-docker.sh 文件，默认可以直接拿来用")]),s._v(" "),t("p",[s._v("这样，等前端构建好，就可以通过运行 build-docker.sh 构建好前端镜像")]),s._v(" "),t("p",[s._v("使用 docker-compose 部署应用\ndocker-compose 是一个关联 docker 容器的工具，他通过一个配置文件来管理多个容器，通过 docker-compose 可以对应用进行部署")]),s._v(" "),t("p",[s._v("docker-compose.yaml 脚本配置")]),s._v(" "),s._m(9),t("p",[s._v("需要注意，可以通过在 docker-compose 中设置环境变量，然后通过设置环境变量，对配置文件进行配置\n如上面示例中的 redis 配置，在配置文件中对应如下配置:")]),s._v(" "),s._m(10),t("p",[s._v("这样就可以通过 docker-compose.yaml 对项目进行配置了\n就像演示工程中的后端的 docker-compose.yaml")]),s._v(" "),s._m(11),t("p",[s._v("前端的 docker-compose.yaml")]),s._v(" "),s._m(12)])}),[function(){var s=this._self._c;return s("h1",{attrs:{id:"业务服务-docker-镜像化"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#业务服务-docker-镜像化"}},[this._v("#")]),this._v(" 业务服务 Docker 镜像化")])},function(){var s=this._self._c;return s("h2",{attrs:{id:"工程示例"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#工程示例"}},[this._v("#")]),this._v(" 工程示例")])},function(){var s=this._self._c;return s("h2",{attrs:{id:"本内容你将获得"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#本内容你将获得"}},[this._v("#")]),this._v(" 本内容你将获得")])},function(){var s=this._self._c;return s("ul",[s("li",[this._v("使用 jib 插件帮后端打镜像")]),this._v(" "),s("li",[this._v("使用 dockerfile 帮前端打镜像")]),this._v(" "),s("li",[this._v("使用 docker-compose 部署应用")])])},function(){var s=this._self._c;return s("h2",{attrs:{id:"使用-jib-插件帮后端打镜像"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用-jib-插件帮后端打镜像"}},[this._v("#")]),this._v(" 使用 jib 插件帮后端打镜像")])},function(){var s=this,t=s._self._c;return t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("      "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("build"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("plugins"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n             "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("plugin"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("groupId"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("com.google.cloud.tools"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/groupId"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("artifactId"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("jib-maven-plugin"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/artifactId"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("version"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.1")]),s._v("."),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("4")]),s._v("<")]),s._v("/version"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("configuration"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                     "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("from"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                         "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("--  基础镜像，由于中台工程使用的jdk为11版本，这里使用jdk11的基础镜像 --"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                         "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("image"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("registry.cn-shenzhen.aliyuncs.com/alinesno-base/openjdk11:11.0."),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v("<")]),s._v("/image"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                     "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/from"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                      "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("打出的镜像的tag设置"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                     "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("to"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                         "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("image"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                                 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("--   docker_repostory  为镜像仓库地址 ， docker_registry_name为镜像仓库项目名\n                                           project.artifactId为镜像名，这里设置为工程artifactId ，\n                                           project.version为镜像版本 ，这里设置为工程版本--"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                                "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("docker_repostory"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("/"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("docker_registry_name"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("/"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${project.artifactId}")]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${project.version}")]),s._v("\n                         "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/image"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                         "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("--\n                         "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("tags"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                             "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("tag"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("project.version"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/tag"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("-- project.version工程版本号 --"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                             "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("-- "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("tag"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("latest"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/tag"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" --"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                         "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/tags"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                          --"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                         "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("auth"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                             "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("--在docker-hub或者阿里云上的账号和密码，这里用环境变量方式，方便适配--"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                             "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("username"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${env.REGISTRY_USERNAME}")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/username"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                             "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("password"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${env.REGISTRY_PASSWORD}")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/password"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                         "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/auth"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                     "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/to"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                     "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("container"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                          "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("--  服务启动配置  --"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                         "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("jvmFlags"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                             "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("jvmFlag"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("-Dfile.encoding"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("UTF-"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("8")]),s._v("<")]),s._v("/jvmFlag"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                              "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("--\n                              调整成 -e "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("JAVA_TOOL_OPTIONS")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-Xms128m -Xmx512m -Dspring.profiles.active=hub"')]),s._v("\n                              传递参数,以适应多种环境\n                              "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("jvmFlag"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("-Xms128m"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/jvmFlag"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                              "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("jvmFlag"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("-Xmx512m"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/jvmFlag"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                              "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("jvmFlag"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("-Dspring.profiles.active"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("hub"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/jvmFlag"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                              "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("jvmFlag"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("-XX:+UseParNewGC"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/jvmFlag"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                              "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("jvmFlag"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("-XX:+UseConcMarkSweepGC"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/jvmFlag"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                               --"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                             "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("jvmFlag"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("-XX:+DisableExplicitGC"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/jvmFlag"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                             "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("jvmFlag"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("-Xdebug"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/jvmFlag"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                             "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("jvmFlag"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("-Duser.timezone"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("GMT+0"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("8")]),s._v("<")]),s._v("/jvmFlag"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                             "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("jvmFlag"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("-Djava.security.egd"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("file:/dev/./urandom"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/jvmFlag"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n\n                         "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/jvmFlags"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                         "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("--  校准时间,设置构建镜像的时间  --"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                         "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("useCurrentTimestamp"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("true"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/useCurrentTimestamp"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                     "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/container"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                      "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("-- 允许使用http连接镜像仓库,默认为false,可以设置为true --"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                     "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("allowInsecureRegistries"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("false"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/allowInsecureRegistries"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/configuration"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n             "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/plugin"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/plugins"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/build"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])])])},function(){var s=this._self._c;return s("h2",{attrs:{id:"使用-dockerfile-帮前端打镜像"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用-dockerfile-帮前端打镜像"}},[this._v("#")]),this._v(" 使用 dockerfile 帮前端打镜像")])},function(){var s=this._self._c;return s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[this._v(" FROM registry.cn-shenzhen.aliyuncs.com/alinesno-base/nginx-alpha:1.1.0     "),s("span",{pre:!0,attrs:{class:"token comment"}},[this._v("#基础镜像")]),this._v("\n WORKDIR /usr/share/nginx/html               "),s("span",{pre:!0,attrs:{class:"token comment"}},[this._v("# 工作目录")]),this._v("\n\n "),s("span",{pre:!0,attrs:{class:"token comment"}},[this._v("# 将dist目录下的内容复制到工作目录下，这里要工程先构建到 dist 目录下")]),this._v("\n COPY ./dist ./\n")])])])},function(){var s=this,t=s._self._c;return t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# !/bin/sh")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 镜像参数")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("docker_repostory")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("docker_repostory"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#docker_repostory指镜像仓库地址")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("docker_registry_name")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("docker_registry_name"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#docker_registry_name指镜像仓库项目名")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("project_artifactid")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("project_artifactid"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#project_artifactid指镜像名")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("project_version")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("project_version"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#project_version指镜像版本号")]),s._v("\n\n "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 构建镜像")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" build -t "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${docker_repostory}")]),s._v("/"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${docker_registry_name}")]),s._v("/"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${project_artifactid}")]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${project_version}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n\n "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 发布镜像")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" push "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${docker_repostory}")]),s._v("/"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${docker_registry_name}")]),s._v("/"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${project_artifactid}")]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${project_version}")]),s._v("\n")])])])},function(){var s=this,t=s._self._c;return t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v(" version: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"3"')]),s._v("\n services:\n     services_name:\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#映射端口")]),s._v("\n         ports:\n             - "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"38080:8080"')]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#副本数量，这里为1")]),s._v("\n         deploy:\n             replicas: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n         image:   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("image_url"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#镜像地址")]),s._v("\n         "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  环境变量配置")]),s._v("\n         environment:\n             - "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("SPRING_APPLICATION_NAME")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("alinesno-cloud-yyt-shop\n             - "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("JAVA_TOOL_OPTIONS")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("-Xms128m -Xmx512m -Dspring.profiles.active"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("hub\n             - "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("SERVER_PORT")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v("                    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#应用启动端口")]),s._v("\n             - "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("REDIS_HOST")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1\n             - "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("REDIS_PORT")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6379")]),s._v("\n             - "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("REDIS_PASSWORD")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("password"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#password:  redis密码")]),s._v("\n         "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#数据卷")]),s._v("\n         volumes:\n             - "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/etc/localtime:/etc/localtime"')]),s._v("\n             - "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./app/upload-files:/root/alinesno-upload-files"')]),s._v("\n             - "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./app/upload-files:/tmp"')]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#容器网络配置，设置网段为172.201.0.0，防止路由冲突")]),s._v("\n networks:\n     suinet:\n         ipam:\n             config:\n             - subnet: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.201")]),s._v(".0.0/16\n")])])])},function(){var s=this._self._c;return s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[this._v("   redis:\n     host: "),s("span",{pre:!0,attrs:{class:"token variable"}},[this._v("${REDIS_HOST}")]),this._v("\n     port: "),s("span",{pre:!0,attrs:{class:"token variable"}},[this._v("${REDIS_PORT}")]),this._v("\n     password: "),s("span",{pre:!0,attrs:{class:"token variable"}},[this._v("${REDIS_PASSWORD}")]),this._v("\n")])])])},function(){var s=this,t=s._self._c;return t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v(" version: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"3"')]),s._v("\n services:\n     demo-service:\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#映射端口")]),s._v("\n         ports:\n             - "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"38080:8080"')]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#副本数量，这里为1")]),s._v("\n         deploy:\n             replicas: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n         image: project_image_url   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#镜像地址")]),s._v("\n         "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  环境变量配置")]),s._v("\n         environment:\n             - "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("SPRING_APPLICATION_NAME")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("SUZE_TEST\n             - "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("JAVA_TOOL_OPTIONS")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" -Xms128m -Xmx512m -Dspring.profiles.active"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("hub\n             - "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("SERVER_PORT")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v("                    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#应用启动端口")]),s._v("\n             - "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("REDIS_HOST")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ENC"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("VfKVXnavjlwb42Sfo8oF3H1UB3iJFmgb"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n             - "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("REDIS_PORT")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ENC"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("l1gtKPHUtWk83ZflT9xNFQ"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n             - "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("REDIS_PASSWORD")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ENC"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ZCcv8B6TyhvMHcARsUj+LvpcMiwndFKOMP/qKsLhBC8"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n             - "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("DATASOURCE_URL")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ENC"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("mUOUukYqxfCd/ZnlgE+SIUJuu8+ldqcJRt1Z8CbWJUwaNwqpPB4YQAP/e9vwJyA0QKuQFPEyfO1cu57E0NKbALaOsBZ/e1xj6lt5eF5vqUFZh8Adgyz2+5hDj+lqHJeXAdfPBv2f7XRVJeM2KF1+QFakACU/MJdjfLvpgHRONlPQeGrehxTGQgpjkrveBB77CXmqDYSjEck"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n             - "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("DATASOURCE_USERNAME")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ENC"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("btFx+DeL1C4/DYK8QFXfIntzcXld/ajo"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n             - "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("DATASOURCE_PASSWORD")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ENC"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("9C5Pev/FjL94gVbPJfaoxGEi8nkXHsNQ"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n         "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#数据卷")]),s._v("\n         volumes:\n             - "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/etc/localtime:/etc/localtime"')]),s._v("\n             - "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./app/upload-files:/root/alinesno-upload-files"')]),s._v("\n             - "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./app/upload-files:/tmp"')]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#容器网络配置，设置网段为172.201.0.0，防止路由冲突")]),s._v("\n networks:\n     servicenet:\n         ipam:\n             config:\n             - subnet: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.201")]),s._v(".0.0/16\n")])])])},function(){var s=this,t=s._self._c;return t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("version: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"3"')]),s._v("\nservices:\n    demo-ui:\n       "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#映射端口")]),s._v("\n        ports:\n          - "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"38081:80"')]),s._v("\n         "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#副本数量，这里为1")]),s._v("\n        deploy:\n          replicas: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n        image:   project_image_url   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#镜像地址")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  环境变量配置")]),s._v("\n        environment:\n          - "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("API_BASE_URL")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("http://demo.service.lbxinhu.linesno.com\n          - "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("SERVER_CDN_URL")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("\n          - "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("SERVER_STORAGE_UPLOAD_URL")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("http://alinesno-saas.admin.dev.rutron.cn/common/storage/upload\n          - "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("SERVER_STORAGE_DISPLAY_URL")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("http://alinesno-storage.admin.dev.rutron.cn/storage/displayImg/\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#数据卷")]),s._v("\n        volumes:\n          - "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/etc/localtime:/etc/localtime"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#容器网络配置，设置网段为172.202.0.0，防止路由冲突")]),s._v("\nnetworks:\n    uinet:\n        ipam:\n            config:\n            - subnet: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.202")]),s._v(".0.0/16\n")])])])}],!1,null,null,null);t.default=e.exports}}]);